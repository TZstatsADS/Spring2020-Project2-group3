---
title: "Data_cleaning"
author: "Ziqin Zhao"
date: "2/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(readr)
library(tidyverse)
library(ggmap)
library(choroplethr)
library(revgeo)
```


```{r}
data<-read_csv("crimeNYC2019.csv")
crime_mahattan<-data%>%
  rename(Date=ARREST_DATE,Area=ARREST_BORO,Crime_type=OFNS_DESC)%>%
  drop_na()%>%
  filter(Area=="M",str_detect(Crime_type,c("ASSAULT","WEAPONS","ROBBERY","MURDER","RAPE",
                                                     "KIDNAPPING","PETIT LARCENY","GRAND LARCENY",
                                           "DRUGS","SEX")))%>% 
  
  select(Date,Crime_type,Longitude,Latitude)%>%
  mutate(Crime_type=str_replace_all(Crime_type,"RAPE","SEX CRIMES"),
         Crime_type=str_replace_all(Crime_type,"PETIT LARCENY","LARCENY"),
         Crime_type=str_replace_all(Crime_type,"GRAND LARCENY","LARCENY"),
         Crime_type=str_replace_all(Crime_type,"GRAND LARCENY OF MOTOR VEHICLE","LARCENY"),
         Crime_type=str_replace_all(Crime_type,"LARCENY OF MOTOR VEHICLE","LARCENY"),
         Crime_type=str_replace_all(Crime_type,"ASSAULT 3 & RELATED OFFENSES","ASSAULT"),
         Crime_type=str_replace_all(Crime_type,"FELONY ASSAULT","ASSAULT"),
         Crime_type=str_replace_all(Crime_type,"MURDER & NON-NEGL. MANSLAUGHTE","MURDER"),
         Crime_type=str_replace_all(Crime_type,"KIDNAPPING & RELATED OFFENSES","KIDNAPPING"))%>%mutate(index=row_number())

    geo_info<-revgeo(crime_mahattan$Longitude,crime_mahattan$Latitude,output ='frame')%>%
    mutate(index=row_number())
    
    geo_info%>%left_join(crime_mahattan%>%mutate(index=row_number()) ,by="index")%>%
    select(Date,Crime_type,zip,Latitude,Longitude)

#save(crime_mahattan, file="crime_mahattan.Rdata")



#revgeo(crime_mahattan$Longitude,crime_mahattan$Latitude,output ='frame')%>%
 # mutate(index=row_number())%>%
  #left_join(crime_mahattan,by="index")%>%
  #select(Date,Crime_type,zip,Latitude,Longitude)


```

```{r}
data2<-read_csv("School_Locations.csv")
school<-data2%>%
  filter(Status_descriptions=="Open")%>%
  mutate(index=row_number())%>%
  select(index,location_type_description,Location_Category_Description,
         primary_address_line_1,LONGITUDE,LATITUDE)%>%
  rename(Type=location_type_description,Category=Location_Category_Description,
         address=primary_address_line_1,Latitude=LATITUDE,Longitude=LONGITUDE)%>%
  drop_na()

#save(school, file="school.Rdata")
#school_zip<-revgeo(school$LONGITUDE,school$LATITUDE,output='frame')%>%
  #mutate(index=row_number())%>%
  #left_join(school,by="index")%>%
  #select(location_type_description,Location_Category_Description,zip,LONGITUDE,LATITUDE)

```
```{r}
load("../data/park_NYC_new.RData")
park_new
load("../data/restaurant.RData")
newdata
```

